画面オペレーション
===

画面オペレーションは、画面上の操作のモデルです。SWATナレッジエンジンで画面を解析し、ナレッジルールによる画面オペレーションを抽出します。画面実装に適したオペレーションを取得する方法の詳細は[画面ナレッジルール](ref_knowledge_rule.md)を参照ください。また、オペレーションの編集やカスタマイズすることができます。スタートガイドの[画面インポート](guide_knowledge.md)から関連情報の取得が可能です。

パラメータ
---

シナリオやフローの作成で画面オペレーションを使いますが、とてもシンプルです。画面オペレーションをドラッグ＆ドロップし、オペレーションの実行に必要なパラメータを入力するだけです。一つのパラメータは**タイトル**、**使用オプション**、 **パラメータデータ**、 **クエリモードスイッチ**と**アラート処理**5つの部分で構成されます。

#### タイトル

パラメータのタイトルはSWATのナレッジエンジンによって自動的に抽出される該当ノードのラベルとなります。**オペレーション編集**画面で手動によるタイトル編集が可能です。

#### 使用オプション

**使用オプション**は、**タイトル**の隣にあるチェックボックスです。これはデフォルトでチェックされ、実行時にパラメータと該当するノードに操作することを意味します。それをオフにした場合、オペレーションを実行する際、該当ノードの操作を無視します。詳細は[パラメータの無視](#パラメータの無視)を参照ください。 

Hint: もしオペレーション中に5つ以上のパラメータががある場合、一番下のチェックボックスですべての**使用オプション**を一気に切り替えることができます。

#### パラメータデータとクエリモードスイッチ

関連するノードの種類によって、**パラメータデータ**には`Text`、`Select`、`Multi-select`と`Execute`４つのタイプがあります。

* `Text`: テキストエリアやテキストボックスなどのようなテキストタイプノードで入力するタイプです。
* `Select`: セレクトタイプのノードにオプションを選択するタイプです。ラジオグループや、リンクかボタンのグループなどの相互に排他的な入力を持つコレクションもこのタイプに属します。
* `Multi-select`: マルチセレクトタイプのノードに複数オプションを選択するタイプです。チェックボックスグループなどの非排他的な入力を持つコレクションもこのタイプに属します。
* `Execute`: 単一のリンクとしてパラメータを指定する必要のないタイプです。

`Text`の場合、通常の入力文字列以外に、`#{KEY}`の形で、特殊キーを入れることも可能です。現在サポートしているKEYは`DOWN`、`LEFT`、`RIGHT`、`UP`、`TAB`、`ENTER`、`ESCAPE`です。

`Select`と`Multi-select`の場合に、**クエリモードスイッチ**（**パラメータデータ**の次の<span class="glyphicon glyphicon-refresh"></span>アイコン）をクリックし、クエリモードへ切り換えることができます。詳細は[パラメータデータのクエリモード](#パラメータデータのクエリモード)を参照ください。 

`Execute`の場合に、**クエリモードスイッチ**を利用して、変数を設定することができます。これはパラメータを無視するためです。詳細は[パラメータの無視](#パラメータの無視)を参照ください。

#### アラート処理

パラメータと関連するノードにアラートを処理する必要があることが設定される場合（SWATの**オペレーション編集**画面で設定）、**パラメータデータ**の下に**アラート処理**エリアが表示されます。アラートを処理するための3つのオプションがあります。

* `OK`: アラートの**OK**をクリックして、アラートを受け入れます。
* `キャンセル`: **キャンセル**をクリックして、アラートを閉じます。
* `処理なし`: 実行時にアラート処理をオフにします。

シナリオでアラートの利用方法は[ウィンドウ、フレーム、アラート、AJAX](article_scenes.md)を参照ください。

Attention: 予想外のアラートが表示される場合もしくは処理するアラートが表示されない場合、実行中エラーで返されます。

パラメータデータのクエリモード
---

サブノードを選択するコレクションノードに関連するパラメータの場合、データは３つのクエリモードを持ちます。`選択モード`、`テキストモード`、`インデックスモード`**クエリモードスイッチ**（**パラメータデータ**の次の<span class="glyphicon glyphicon-refresh"></span>アイコン）で切り替えることができます。

#### 選択モード

これはデフォルトモードです。パラメータデータフィールドに画面ナレッジでの選択肢を選び、実行時に選択されたサブノードをローケーティングして選択します。

* マルチセレクトタイプのノードでは、いくつかのサブのノードを選択することができます。
* サブノード自身がコレクションノードの場合、このモードは使用できません。そのときに、`テキストモード`はデフォルトモードです。
* 変数は使用できません。

#### テキストモード

パラメータデータフィールドは、<span class="glyphicon glyphicon-font"></span>アイコンとテキストボックスで表示されます。実行時に、SWATは入力したテキストと一致した（順番に`equal`, `startWith`, `contain`の方法でマッチング）サブノードを探し、選択します。

* マルチセレクトタイプのノードでは、いくつかのサブノードのクエリテキストを`,`で分割します。例えば、`red,blue`は、テキスト`red`を含むサブノードとテキスト`blue`を含むサブノードを選択します。空白の場合、何も選択しません。
* シングルセレクトタイプのノードでは、空白は許可されていません。
* 変数は使用できます。

#### インデックスモード

パラメータデータフィールドは、<span class="glyphicon glyphicon-th-list"></span>アイコンとテキストボックスで表示されます。実行時に、SWATは位置によってサブノードを探し、選択します。インデックス`1`やそれ以上大きい数字は最初からの順番で指定するために使用し、インデックス`-1`やそれより小さな数字は最後からの順番で指定するために使用します。

* マルチセレクトタイプのノードでは、いくつかのサブノードのクエリテキストを`,`で分割します。例えば、`1,2`は、1番目と2番目のサブノードを選択します。空白の場合、何も選択しません。
* シングルセレクトノードでは、`0`を除く整数のみ許可します。
* 変数は使用できます。

エラー
---

画面オペレーションは、検証中や実行中にさまざまなエラーが発生する可能性があります。もっとも共通的なエラーを以下に示します。

* パラメータデータが有効ではありません。 (検証中と実行中)
`テキストモード`、`インデックスモード`のパラメータ値は有効でありません。詳細は[パラメータデータのクエリモード](#パラメータデータのクエリモード)を参照ください。 パラメータで変数を使用する場合、エラーの検出は実行時になります。
* 対象画面が見つかりません。（実行中）
対象画面の画面識別で定義されているマッチングルールを満たしていない場合に発生するエラーです。
* 対象オペレーションが見つかりません。（実行中）
期待されたオペレーションが存在しません。
* 対象ノードが見つかりません。（実行中）
期待されたノードが存在しません。
* 対象サブノードが見つかりません。（実行中）
パラメータの入力に基づきクエリモードで、一致した結果が見つかりません。

エビデンス
---

すべての画面オペレーションは、実行後のアクティブウィンドウからスクリーンショットとHTMLをエビデンスとして取ります。もしオペレーションが、入力やフォームのサブミットなどのいくつかのステップが含まれている場合、最後のステップの前にもう一つのスクリーンショットを取得します。また、オペレーションの中に任意のアラート処理があった場合アラートのエビデンスも取得可能になります。

* スクリーンショット
* HTML
* サブミット前のスクリーンショット
* JSONテキストフォーマットでアラート情報

もし多ウインドゥで、他のウィンドウ画面でエビデンスを取得したい場合、**ウィンドウ制御**システムオペレーションで対象ウィンドウ画面に切り替える必要があります。

変数の使用
---

データとシナリオを分離するために、パラメータデータフィールドに`@{変数名}`（波括弧）の形式で変数を設定することができます。**画面変数設定**オペレーションと**外部API呼び出し**オペレーションで設定した変数の除く、シナリオ/フローのすべての変数がそのシナリオ/フローのパラメータになります。テストケースのデータをオペレーション実行中で利用できます。

変数を使用するには、以下の規則に準拠します。

* 変数名は数字、アルファベット、日本語、漢字と`_`の文字列でなければなりません。
* `@{var1}abc@{var2}`のような1つのパラメータデータ内の複数の変数を使用することができます。
* 変数は、テキスト入力タイプのパラメータのみで使用することができます。その他の場合、クエリモードで変数が利用できるモードに切り替える必要があります。
* 変数を使用する場合、検証エラーが実行されるまで検出されません。

Hint: 通常定義した変数のスコープがローカルのため、フローの中から外の変数や、そとからフローの変数をアクセスすることができません。ただし、変数名の先頭に`_`を入れることで（例えば、`@{_var}`）、グロバル変数の定義が出来ます。

パラメータの無視
---

パラメータを無視するのは、実行中にパラメータと関連するノードの操作を飛ばすことを意味します。

実行中のパラメータを無視するには、いくつかの方法があります。

1. シナリオ/フロービルダーで、パラメータの**使用オプション**のチェックを外します。
2. ケース新規・編集ダイアログ該当パラメータにあるすべての変数の**使用オプション**のチェックを外します。（Excelの出力・インポート機能でも利用可能です。）
3. 親ノードのパラメータを無視します。例えば、各行に入力を持つテーブル操作などの複雑なネストされたノードの動作の場合、行を選択する親ノードを無視すると、子ノード（行の入力）も実行時に無視されます。
4. オペレーションを無視します。この場合、すべてのパラメータが無視されます。

オペレーションの無視
---

シナリオ/フロー·ビルダーでオペレーションを無視する意味はありませんが、ケースのデータ設定によっては、オペレーションを無視する必要があるかもしれません。 

パラメータの無視と同様に、ケース新規・編集ダイアログ該当オペレーションにあるすべての変数の**使用オプション**のチェックを外すと、オペレーションの動作を無視することができます。（Excelの出力・インポート機能でも利用可能です。）例えば、 *検索ボッス*、*検索ボタン*を持つ*検索*オペレーションで*検索ボックス*のための変数1`@{SearchKey}`を使用します。もし変数 `SearchKey`の**使用オプション**をオフにすると、実行時に*検索*オペレーションをバイパスすることができます。

オペレーションが無視されている場合、テスト結果のエビデンスは表示されません。

Note: オペレーションの無視はオペレーションのすべてのパラメータの無視と違います。後者の場合、何も操作はしないオペレーションが実行されるため、エビデンスが残ります。
