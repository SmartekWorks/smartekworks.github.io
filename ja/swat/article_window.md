ウィンドゥとフレーム対応
===

SWATでマルチウィンドゥ、マルチフレーム構成のアプリに対応する方法を説明します。

マルチウィンドゥ対応
---

複数ウィンドゥを利用するWebアプリがよくあります。例えば、プロダクトリンクをクリックして、新しいウィンドゥでプロダクトの詳細が表示されるものや、古いIE専用のモデルダイアログもウィンドウとして実装されています。複数ウィンドゥを自動化シナリオで操作する際に通常のシナリオより少し複雑なため、その対応方法を説明します。

#### ナレッジ対応

まず、ウィンドゥごとに違う[画面ナレッジ](guide_knowledge.md#SWATナレッジベースについて)として、それぞれの画面を[SWATキャプチャー](setup_tools.md#SWATキャプチャー)でHTMLファイルを取得し、インポートする必要があります。

Hint: ブラウザツールバーが表示されない子ウィンドゥの場合、ウィンドゥで右クリックしてキャプチャーメニューを押すことが可能です（Chromeb版のみ）。

#### シナリオ対応

通常**シナリオビルダー**にウィンドゥを指定する必要がありません。ある画面のあるオペレーションをドラッグ＆ドロップしてシナリオを作成します。実行する際に、SWATが複数ウィンドウの中で操作したい画面を自動的に探してオペレーションを実行することになります。

しかし、複数似たようなウィンドゥの場合（例えば同じ対象オペレーションを持っている）、対象ウィンドゥを探すために下記のように追加情報を定義する必要です。

* [ウィンドゥ制御](ref_sys_operation.md#オペレーション_-_ウィンドゥ制御)システムオペレーションで明示的にウィンドゥの切り替えを定義します。
* 実行中に正しく対象画面を見つけるために、対象画面の[画面識別情報](ref_mq_rule.md#ブラウザウィンドゥを特定)を定義します。

Hint: 画面エビデンスの取得及び一部ウィンドゥと関係するシステムオペレーション（例えば**画面検証**、**画面変数設定**など）が現在一番トップであるウィンドゥに対して実行することで、必要に応じて、対象ウィンドゥに切り替える必要が有ります。

マルチフレーム対応
---

複数ウィンドゥのWebアプリと比べて、`frame`もしくは`iframe`を利用する多フレームのWebアプリの方がもっと複雑です。なぜなら、複数物理的なHTMLが存在するほか、多階層の親子関係もケアしなければけません。ここでこのようなWebアプリの対応方法を紹介します。

#### ナレッジ対応

ブラウザのHTML保存機能を利用すると一番外枠のHTMLしか保存できないため、マルチフレームの場合、[SWATキャプチャー](setup_tools.md#SWATキャプチャー)を利用してキャプチャする必要があります。そうすると、すべてのフレームのHTMLは、まとめて一つの`SHTM`ファイルに固められ、１画面としてインポートされます。

Note: ブラウザのセキュリティ上の仕様から、異なるドメインのフレーム内容をキャプチャすることができません。

#### シナリオ対応

ナレッジインポートが正しくできると、フレームの構成情報もナレッジに含まれるので、シナリオを実行する際に、対象フレームを自動的に探します。この機能を有効にするためには、該当サイトの[実行パラメータの設定](setup_execservices.md#実行パラメータの設定)の`frameSearchDepth`を設定する必要があります。

３階層以下のフレームを利用する場合、下記のように`3`を設定すれば良いです。

```json
{"frameSearchDepth": 3}
``` 

フレームを利用しない場合、下記のように`0`を設定する方が実行性能が上がります。

```json
{"frameSearchDepth": 0}
``` 

#### スクリーンショット対応

フレームを利用しても、SWATは画面全体のスクリーンショットをエビデンスとして撮れます。ただし、一部のフレームをスクロールして内容のスクリーンショットを撮るケースもよくあります。この場合、フレームの`name`もしくは`id`を指定し、特定なフレームの内容をスクロールで撮ることができます。

設定するために、該当サイトの[実行パラメータの設定](setup_execservices.md#実行パラメータの設定)の`scrollableFrames`を設定する必要があります。

```json
{"scrollableFrames": ["name":"frame1", "id":"frame2"]}
``` 
